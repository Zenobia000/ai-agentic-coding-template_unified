# ç³»çµ±è¨­è¨ˆï¼šæ¶æ§‹å¸«æ­¦åƒ§ Agent (Architect Warrior Monk Agents)

> **ç‰ˆæœ¬**ï¼šv0.1 (MVP Planning)
> **ä¾†æº**ï¼šã€Šè»Ÿé«”æ¶æ§‹ç²¾é€š - æ¶æ§‹å¸«æ­¦åƒ§å¯¶å…¸ã€‹
> **ç›®æ¨™**ï¼šæ‰“é€ ä¸€å€‹ã€Œè™›æ“¬æ¶æ§‹å§”å“¡æœƒã€ï¼Œå¼•å°ç”¨æˆ¶èµ°å®Œæ¶æ§‹è¨­è¨ˆä¸ƒæ­¥æµç¨‹ï¼Œç”¢å‡ºå¯åŸ·è¡Œçš„æ¶æ§‹æ–‡ä»¶ã€‚

---

## 1. æ ¸å¿ƒè¨­è¨ˆå“²å­¸ (Core Philosophy)

æœ¬ç³»çµ±éµå¾ªä»¥ä¸‹ä¸‰å¤§åŸå‰‡ï¼Œç¢ºä¿ç”¢å‡ºä¸åƒ…æ˜¯èŠå¤©è¨˜éŒ„ï¼Œè€Œæ˜¯å·¥ç¨‹è³‡ç”¢ï¼š

1.  **è³‡æ–™çµæ§‹å„ªå…ˆ (Data-First)**
    *   Agent ä¹‹é–“ä¸å‚³éè‡ªç„¶èªè¨€ï¼Œè€Œæ˜¯å‚³éçµæ§‹åŒ–çš„ `ArchitectureContext` (JSON/YAML)ã€‚
    *   ç¢ºä¿ä¸Šä¸‹æ–‡åœ¨å¤šå€‹ Agent ä¹‹é–“ç„¡æå‚³éã€‚

2.  **è©¢å•å¼å¼•å° (Socratic Method)**
    *   Agent ä¸ç›´æ¥çµ¦ç­”æ¡ˆï¼Œè€Œæ˜¯é€éã€Šå¯¶å…¸ã€‹ä¸­çš„é—œéµå•é¡Œï¼ˆå¦‚ã€Œé€™èƒ½è³ºéŒ¢å—ï¼Ÿã€ã€ã€ŒP99 å»¶é²è¦æ±‚æ˜¯å¤šå°‘ï¼Ÿã€ï¼‰ä¾†é€¼å•ä½¿ç”¨è€…ã€‚
    *   ç›®æ¨™æ˜¯å¡«è£œè³‡è¨Šç¼ºå£ï¼Œè€Œéå–®ç´”ç”Ÿæˆæ–‡å­—ã€‚

3.  **æ–‡ä»¶å³ä»£ç¢¼ (Docs as Code)**
    *   æ‰€æœ‰ç”¢å‡ºçš†ç‚º Markdown / Mermaid / OpenAPI / ADR æ¨™æº–æ ¼å¼ã€‚
    *   ç”¢å‡ºç‰©å¯ç›´æ¥é€²å…¥ Git ç‰ˆæœ¬æ§åˆ¶ï¼Œä½œç‚ºå°ˆæ¡ˆçš„ Single Source of Truthã€‚

---

## 2. ç³»çµ±æµç¨‹åœ– (System Flow)

é€™æ˜¯ä¸€å€‹ç·šæ€§ä½†å¯è¿­ä»£çš„ Pipelineï¼Œå°æ‡‰ã€Šæ¶æ§‹å¸«æ­¦åƒ§å¯¶å…¸ã€‹çš„ **ä¸ƒæ­¥æ¶æ§‹è¨­è¨ˆæµç¨‹**ã€‚

```mermaid
graph TD
    User((ç”¨æˆ¶)) --> Orchestrator[ğŸ§™â€â™‚ï¸ ç¸½æ¶æ§‹å¸« (Orchestrator)]
    
    Orchestrator --> Step1[ğŸ•µï¸ éœ€æ±‚åˆ†æå¸« Agent]
    Step1 --> |PRD & NFRs| Step2[ğŸ§  é ˜åŸŸå»ºæ¨¡å¸« Agent]
    Step2 --> |Domain Model| Step3[âš–ï¸ æŠ€è¡“ç­–ç•¥å¸« Agent]
    Step3 --> |Tech Stack & TCO| Step4[ğŸ—ï¸ ç³»çµ±è¨­è¨ˆå¸« Agent]
    Step4 --> |C4 & API| Step5[ğŸ›¡ï¸ é¢¨éšªè©•ä¼°å¸« Agent]
    Step5 --> |Risk Report| Step6[ğŸ‘¨â€ğŸ’» æŠ€è¡“ä¸»ç®¡ Agent]
    Step6 --> |Scaffold & Guidelines| Step7[ğŸ¦… æ¼”é€²å®ˆè­·è€… Agent]
    Step7 --> |Observability| Docs[ğŸ“š æœ€çµ‚æ¶æ§‹ç™½çš®æ›¸]

    subgraph "Shared Context (State)"
        req[éœ€æ±‚çŸ©é™£]
        const[ç´„æŸæ¢ä»¶]
        decisions[ADR æ±ºç­–]
    end
```

---

## 3. ç¯€é»è©³ç´°è¨­è¨ˆ (Node Specifications)

æ¯å€‹ç¯€é»éƒ½æ˜¯ä¸€å€‹å°ˆé–€çš„ Agentï¼Œæ“æœ‰ç¨ç«‹çš„ System Prompt å’Œè¼¸å…¥/è¼¸å‡ºè¦ç¯„ã€‚

### Node 1: éœ€æ±‚åˆ†æå¸« (The Analyst)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 2 ç«  (éœ€æ±‚åˆ†æ) & ç¬¬ 9 ç«  (ç´„æŸæ¢ä»¶)
*   **æ ¸å¿ƒä»»å‹™**ï¼šå°‡æ¨¡ç³Šé¡˜æ™¯è½‰åŒ–ç‚ºé‡åŒ–æŒ‡æ¨™ã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   **å•†æ¥­ç›®æ¨™ (Why)**ï¼šé€™å€‹ç³»çµ±å¦‚ä½•è³ºéŒ¢æˆ–çœéŒ¢ï¼Ÿ
    *   **ç´„æŸæ¢ä»¶ (Constraints)**ï¼šé ç®—ï¼ŸDeadlineï¼Ÿåœ˜éšŠæŠ€èƒ½æ¨¹ï¼Ÿ
    *   **NFR é‡åŒ–**ï¼šæ‹’çµ•å½¢å®¹è©ï¼ˆå¾ˆå¿«ï¼‰ï¼Œè¦æ±‚æ•¸å­—ï¼ˆP99 < 200msï¼‰ã€‚
    *   **é æœŸè¦æ¨¡**ï¼šDAUï¼Ÿè³‡æ–™å¢é•·é‡ï¼Ÿ
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ“„ `01_PRD.md` (ç”¢å“éœ€æ±‚æ–‡ä»¶)
    *   ğŸ“Š `02_NFR_Matrix.csv` (é‡åŒ–çš„éåŠŸèƒ½éœ€æ±‚çŸ©é™£)
    *   ğŸ“ `03_Constraints.json` (æ™‚é–“ã€é ç®—ã€äººåŠ›é™åˆ¶)

### Node 2: é ˜åŸŸå»ºæ¨¡å¸« (The Modeler)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 3 ç«  (æ¦‚å¿µè¨­è¨ˆ)
*   **æ ¸å¿ƒä»»å‹™**ï¼šåŠƒåˆ†é‚Šç•Œï¼Œè­˜åˆ¥æ ¸å¿ƒå¯¦é«” (DDD)ã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   æœ‰å“ªäº›æ ¸å¿ƒåè©ï¼Ÿ(Ubiquitous Language)
    *   æ¥­å‹™æµç¨‹çš„é‚Šç•Œåœ¨å“ªè£¡ï¼Ÿèª°è² è²¬ä»€éº¼ï¼Ÿ
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ“ `04_Domain_Model.mermaid` (é¡åˆ¥åœ–/ERåœ–)
    *   ğŸ—ºï¸ `05_Context_Map.mermaid` (Bounded Contexts)

### Node 3: æŠ€è¡“ç­–ç•¥å¸« (The Strategist)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 4 ç«  (æŠ€è¡“é¸å‹)
*   **æ ¸å¿ƒä»»å‹™**ï¼šåŸºæ–¼ ROI å’Œ TCO é¸æ“‡æŠ€è¡“å †ç–Šã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   åœ˜éšŠæœ€ç†Ÿå“ªç¨®èªè¨€ï¼Ÿ(Node/Python/Java/Go)
    *   æ˜¯ä¸€è‡´æ€§é‡è¦ (ACID) é‚„æ˜¯å¯ç”¨æ€§é‡è¦ (BASE)ï¼Ÿ
    *   é›²ç«¯é ç®—ä¸Šé™ï¼Ÿ
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ“‹ `06_Tech_Stack.md` (å‰ç«¯/å¾Œç«¯/DB/Infra é¸å‹æ¸…å–®)
    *   ğŸ’° `07_TCO_Analysis.md` (é ä¼°æˆæœ¬åˆ†æ)
    *   ğŸ“œ `ADR-001-Tech-Stack-Selection.md` (æ¶æ§‹æ±ºç­–è¨˜éŒ„)

### Node 4: ç³»çµ±è¨­è¨ˆå¸« (The Architect)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 6 ç«  (çµ„ä»¶æ¶æ§‹) & ç¬¬ 7 ç«  (å®è§€è¦–è§’)
*   **æ ¸å¿ƒä»»å‹™**ï¼šç¹ªè£½è—åœ–ï¼Œå®šç¾©æ¥å£ã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   æ˜¯å¦éœ€è¦å¾®æœå‹™ï¼Ÿ(Check: åœ˜éšŠè¦æ¨¡ > 20äººï¼Ÿ)
    *   é€šè¨Šæ¨¡å¼ï¼Ÿ(REST vs gRPC vs Queue)
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ—ï¸ `08_System_Architecture_C4.mermaid` (C4 æ¨¡å‹åœ–)
    *   ğŸ”Œ `09_API_Spec_Draft.yaml` (OpenAPI åˆç¨¿)
    *   ğŸŒŠ `10_Data_Flow.mermaid` (é—œéµæ¥­å‹™æ•¸æ“šæµåœ–)

### Node 5: é¢¨éšªè©•ä¼°å¸« (The Validator)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 5 ç«  (å“è³ªå±¬æ€§)
*   **æ ¸å¿ƒä»»å‹™**ï¼šæ”»æ“Šæ¶æ§‹ï¼Œæ‰¾å‡ºå¼±é»ã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   å¦‚æœ DB æ›äº†æ€éº¼è¾¦ï¼Ÿ
    *   å¦‚æœæµé‡çªç„¶æš´å¢ 10 å€ï¼Ÿ
    *   å–®é»æ•…éšœ (SPOF) åœ¨å“ªè£¡ï¼Ÿ
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   âš ï¸ `11_Risk_Assessment.md` (é¢¨éšªèˆ‡ç·©è§£æªæ–½)
    *   ğŸ”¥ `12_Failure_Mode_Analysis.md` (æ•…éšœæ¨¡å¼åˆ†æ)

### Node 6: æŠ€è¡“ä¸»ç®¡ (The Tech Lead)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 3 ç«  (å¯¦æ–½æŒ‡å°)
*   **æ ¸å¿ƒä»»å‹™**ï¼šè®“å·¥ç¨‹å¸«èƒ½é–‹å·¥ã€‚
*   **é—œéµæå• (Input Strategy)**ï¼š
    *   Git Flow ç­–ç•¥ï¼Ÿ
    *   Linter/Formatter è¦ç¯„ï¼Ÿ
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ“ `13_Development_Guidelines.md` (é–‹ç™¼è¦ç¯„)
    *   ğŸ“‚ `14_Project_Structure_Tree.txt` (å»ºè­°çš„è³‡æ–™å¤¾çµæ§‹)
    *   ğŸš€ `15_Scaffold_Command.sh` (åˆå§‹åŒ–å°ˆæ¡ˆçš„æŒ‡ä»¤å»ºè­°)

### Node 7: æ¼”é€²å®ˆè­·è€… (The Guardian)
*   **å°æ‡‰ç« ç¯€**ï¼šç¬¬ 5 ç«  (å¯è§€å¯Ÿæ€§) & ç¬¬ 8 ç«  (é€²éšæ¨¡å¼)
*   **æ ¸å¿ƒä»»å‹™**ï¼šç¢ºä¿ç³»çµ±ä¸Šç·šå¾Œå¯ç¶­è­·ã€‚
*   **è¼¸å‡ºç”¢ç‰© (Output)**ï¼š
    *   ğŸ”­ `16_Observability_Plan.md` (Logging/Metrics/Tracing ç­–ç•¥)
    *   ğŸ›£ï¸ `17_Evolution_Roadmap.md` (MVP ä¹‹å¾Œçš„æ¼”é€²è·¯å¾‘)

---

## 4. è³‡æ–™çµæ§‹å®šç¾© (Data Structure)

é€™æ˜¯ Agent ä¹‹é–“å‚³éçš„ `State` å®šç¾© (Pseudo-Python Pydantic Model)ï¼š

```python
class ArchitectureContext:
    # 1. éœ€æ±‚ (Node 1)
    project_name: str
    business_goals: List[str]
    constraints: Dict[str, Any] # budget, timeline, team_skill
    nfr_metrics: Dict[str, str] # {"latency": "200ms", "availability": "99.9%"}
    
    # 2. é ˜åŸŸ (Node 2)
    entities: List[str]
    bounded_contexts: List[str]
    
    # 3. æŠ€è¡“æ±ºç­– (Node 3)
    tech_stack: Dict[str, str] # {"backend": "Python/FastAPI", "db": "PostgreSQL"}
    architecture_style: str # "Monolith", "Microservices", "Serverless"
    adr_records: List[Dict]
    
    # 4. è¨­è¨ˆ (Node 4)
    c4_containers: List[Dict]
    api_endpoints: List[str]
    
    # 5. è¼¸å‡ºæª”æ¡ˆè·¯å¾‘
    generated_files: List[str]
```

---

## 5. å¯¦ä½œè¨ˆç•« (Implementation Plan)

### Phase 1: MVP (æ ¸å¿ƒä¸‰å·¨é ­)
*   **ç›®æ¨™**ï¼šæœ€å°å¯è¡Œæ€§æµç¨‹ï¼Œç”¢å‡ºåŸºæœ¬çš„æ¶æ§‹åœ–èˆ‡ PRDã€‚
*   **æˆå“¡**ï¼š
    1.  **Orchestrator** (è·¯ç”±èˆ‡ç‹€æ…‹ç®¡ç†)
    2.  **Node 1: éœ€æ±‚åˆ†æå¸«** (ç¢ºä¿æ–¹å‘æ­£ç¢º)
    3.  **Node 4: ç³»çµ±è¨­è¨ˆå¸«** (ç”¢å‡º C4 åœ–èˆ‡æŠ€è¡“æ£§ï¼Œæš«æ™‚å¸æ”¶ Node 2/3 åŠŸèƒ½)

### Phase 2: Enhanced (æ±ºç­–èˆ‡é¢¨éšª)
*   **ç›®æ¨™**ï¼šå¢åŠ æ·±åº¦èˆ‡ç©©å®šæ€§ã€‚
*   **æˆå“¡**ï¼š
    *   åŠ å…¥ **Node 3: æŠ€è¡“ç­–ç•¥å¸«** (ç”¢å‡º ADR)
    *   åŠ å…¥ **Node 5: é¢¨éšªè©•ä¼°å¸«** (é€²è¡Œæ¶æ§‹æ”»æ“Šæ¨¡æ“¬)

### Phase 3: Complete (è½åœ°èˆ‡é‹ç¶­)
*   **ç›®æ¨™**ï¼šå…¨æµç¨‹è¦†è“‹ï¼Œç›´æ¥ç”Ÿæˆä»£ç¢¼è…³æ‰‹æ¶ã€‚
*   **æˆå“¡**ï¼š
    *   åŠ å…¥ **Node 2, 6, 7** (è£œå®Œé ˜åŸŸå»ºæ¨¡ã€å¯¦æ–½æŒ‡å°èˆ‡æ¼”é€²è¦åŠƒ)

